# 德州扑克积分统计系统 (CrisCL) v0.1.1

一个现代化的德州扑克游戏数据统计Web应用，采用前后端分离架构，支持多设备访问。

## ✨ 功能特性

### 核心功能
- 🎮 **游戏记录管理** - 开始、结束、保存、舍弃游戏
- 📊 **玩家盈亏统计** - 筹码、现金、BB统计
- 📈 **历史记录查询** - 完整的游戏历史和筛选
- 👤 **玩家详情分析** - 个人统计数据和趋势
- ⭐ **收藏玩家功能** - 快速访问常用玩家
- ⚖️ **账目平衡检查** - 自动验证数据一致性

### v0.1.1 新增功能
- 💾 **游戏状态自动保存** - 刷新页面不丢失进度
- 🗑️ **舍弃游戏功能** - 不保存当前游戏数据
- 🎯 **精确时间计算** - 按分钟计算每小时盈利
- 📱 **移动端优化** - 竖屏显示优化，按钮布局改进
- ➕➖ **手数灵活输入** - 支持0和负数（卸码场景）
- 🎨 **UI细节优化** - 图标文字间距、输入框宽度调整
- 🔄 **小盲大盲验证** - 失焦时验证避免输入干扰

### 通用特性
- 📱 **响应式设计** - 支持手机、平板、PC
- 🔄 **实时数据同步** - 多设备数据共享
- 🖥️ **跨平台脚本** - macOS和Windows双平台支持

## 🏗️ 技术架构

### 前端技术栈
- **React 18** - 现代化UI框架
- **Vite** - 快速构建工具
- **Tailwind CSS** - 实用优先的CSS框架
- **localStorage** - 游戏状态持久化

### 后端技术栈
- **Node.js** - JavaScript运行环境
- **Express** - Web应用框架
- **JSON文件** - 轻量级数据存储
- **CORS** - 跨域资源共享

## 📁 项目结构

```
CrisCL/
├── frontend/                    # 前端应用
│   ├── src/
│   │   ├── components/          # React组件
│   │   │   ├── CurrentGame.jsx  # 当前游戏页面
│   │   │   ├── History.jsx      # 历史记录页面
│   │   │   ├── PlayerDetail.jsx # 玩家详情页面
│   │   │   └── Icons.jsx        # SVG图标组件
│   │   ├── utils/               # 工具函数
│   │   │   ├── storage.js       # API存储封装
│   │   │   └── helpers.js       # 辅助函数
│   │   ├── App.jsx              # 主应用组件
│   │   ├── main.jsx             # 应用入口
│   │   └── index.css            # 全局样式
│   ├── 启动开发服务器.command    # macOS启动脚本
│   └── 启动开发服务器.bat        # Windows启动脚本
│
├── backend/                     # 后端服务
│   ├── data/                    # 数据存储
│   │   ├── games.json           # 游戏历史记录
│   │   ├── gamePlayers.json     # 游戏玩家关联
│   │   ├── players.json         # 玩家数据
│   │   └── poker-favorites.json # 收藏玩家
│   ├── server.js                # Express服务器
│   ├── dataStore.js             # 数据存储模块
│   ├── 启动后端服务器.command    # macOS启动脚本
│   └── 启动后端服务器.bat        # Windows启动脚本
│
├── 启动全部服务.command          # macOS一键启动
├── 启动全部服务.bat              # Windows一键启动
├── 停止所有服务.command          # macOS停止服务
├── 停止所有服务.bat              # Windows停止服务
├── 检查服务状态.command          # macOS状态检查
├── 检查服务状态.bat              # Windows状态检查
└── README.md                    # 项目文档
```

## 🚀 快速开始

### 环境要求
- Node.js 18+ 
- npm 或 yarn

### 方式一：一键启动（推荐）

#### macOS 用户
在 Finder 中双击 `启动全部服务.command`

#### Windows 用户
在文件资源管理器中双击 `启动全部服务.bat`

系统会自动：
1. 检查并安装依赖
2. 启动后端服务器（端口3001）
3. 启动前端服务器（端口3000）
4. 显示访问地址（包括手机访问地址）

### 方式二：分别启动

**启动后端：**
```bash
cd backend
npm install  # 首次运行
npm start
```

**启动前端：**
```bash
cd frontend
npm install  # 首次运行
npm run dev
```

### 访问应用

- **本机访问**：http://localhost:3000
- **手机访问**：http://[你的电脑IP]:3000（需在同一WiFi）

## 🎮 使用指南

### 当前游戏页面

#### 1. 配置游戏
- 游戏名称自动生成（格式：MM/DD/YY 周几）
- 设置小盲/大盲（支持失焦验证）
- 设置每手Buy-in筹码量
- 设置筹码汇率（多少筹码=1$）

#### 2. 添加玩家
- 输入玩家姓名
- 设置手数（支持0和负数，负数表示卸码）
- 使用加减按钮快速调整手数

#### 3. 游戏流程
- **开始游戏**：记录开始时间，启动计时器
- **进行中**：更新玩家最终筹码数，实时查看盈亏
- **结束游戏**：记录结束时间
- **保存游戏**：确认账目平衡后保存到历史记录
- **舍弃游戏**：不保存当前游戏，直接重置

#### 4. 自动保存
- 游戏进行中自动保存状态到 localStorage
- 刷新页面或关闭浏览器后可恢复
- 保存或舍弃游戏后自动清除临时状态

### 历史记录页面

1. **查看所有游戏** - 显示完整的游戏历史
2. **按玩家筛选** - 查看特定玩家的记录
3. **收藏玩家** - 点击星标收藏常用玩家
4. **查看详情** - 点击玩家姓名查看统计数据
5. **统计数据** - 总盈亏、平均每局、每小时盈利（精确到分钟）
6. **删除记录** - 删除不需要的游戏记录

### 玩家详情页面

- 查看玩家所有历史记录
- 统计总盈亏、平均表现
- 每小时盈利率（精确计算）
- 游戏场次和时长统计

## 💾 数据管理

### 数据存储
- **位置**: `backend/data/` 目录
- **格式**: JSON文件
- **持久化**: 
  - 历史记录存储在后端
  - 当前游戏状态存储在 localStorage

### 数据备份
```bash
# 备份数据
cp -r backend/data backend/data_backup_$(date +%Y%m%d)

# 恢复数据
cp -r backend/data_backup_YYYYMMDD/* backend/data/
```

## 🔧 服务管理

### 检查服务状态
- **macOS**: 双击 `检查服务状态.command`
- **Windows**: 双击 `检查服务状态.bat`

### 停止所有服务
- **macOS**: 双击 `停止所有服务.command`
- **Windows**: 双击 `停止所有服务.bat`

### 查看日志
```bash
# 查看后端日志
tail -f backend.log

# 查看前端日志
tail -f frontend.log
```

## 📡 API接口

### 基础信息
- **后端地址**: `http://localhost:3001/api`
- **前端地址**: `http://localhost:3000`
- **数据格式**: JSON

### 主要接口

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/health | 健康检查 |
| GET | /api/storage/:key | 获取存储数据 |
| POST | /api/storage | 保存存储数据 |
| DELETE | /api/storage/:key | 删除存储数据 |

## 📱 移动端使用

### 连接方式
1. 确保手机和电脑在同一WiFi网络
2. 启动服务后查看终端显示的IP地址
3. 在手机浏览器访问：`http://[IP地址]:3000`

### 移动端优化
- 竖屏布局优化
- 标题信息两行显示
- 配置项对齐美观
- 按钮布局合理（开始/结束一行，保存/舍弃一行）
- 手数控件带加减按钮
- 最终码量输入框宽度优化

## 🛠️ 开发指南

### 开发命令
```bash
# 前端开发
cd frontend
npm run dev          # 启动开发服务器
npm run build        # 构建生产版本
npm run preview      # 预览生产版本

# 后端开发
cd backend
npm start            # 启动服务器
```

### 代码结构
- **组件化**: 每个功能独立为React组件
- **模块化**: 工具函数和API调用分离
- **响应式**: 使用Tailwind CSS实现
- **类型安全**: 使用现代JavaScript特性

## 🔍 故障排查

### 常见问题

**1. 服务启动失败**
- 检查端口3000和3001是否被占用
- 确认Node.js版本 >= 18
- 重新安装依赖：`rm -rf node_modules && npm install`

**2. 前端无法连接后端**
- 确认后端服务正常运行（检查服务状态）
- 检查防火墙设置
- 查看浏览器控制台错误信息

**3. 刷新后游戏状态丢失**
- 检查浏览器是否支持 localStorage
- 查看浏览器控制台是否有错误
- 确认游戏已经开始（未开始的游戏不会保存）

**4. 移动端无法访问**
- 确认设备在同一WiFi网络
- 检查电脑防火墙设置
- 使用正确的IP地址（非localhost）
- 尝试重启路由器

**5. macOS 无法运行 .command 文件**
```bash
# 添加执行权限
chmod +x *.command
chmod +x backend/*.command
chmod +x frontend/*.command
```

## 📈 版本历史

### v0.1.1 (2025-10-29)
- ✅ **游戏状态自动保存** - 刷新页面不丢失数据
- ✅ **舍弃游戏功能** - 支持不保存直接重置
- ✅ **每小时盈利精确计算** - 按分钟计算更准确
- ✅ **移动端布局优化** - 竖屏显示更友好
- ✅ **小盲大盲验证改进** - 失焦时验证
- ✅ **手数支持负数** - 适应卸码场景
- ✅ **UI细节优化** - 图标间距、输入框宽度
- ✅ **跨平台脚本** - Windows .bat 文件支持
- ✅ **按钮布局优化** - 移动端两行显示

### v0.0.1 (2025-10-28)
- ✅ 初始版本发布
- ✅ 前后端分离架构
- ✅ 完整的游戏记录功能
- ✅ 玩家统计和分析
- ✅ 响应式设计
- ✅ 多设备数据同步

## 🎯 后续计划

- [ ] 数据可视化图表
- [ ] 导出Excel报表
- [ ] 多房间支持
- [ ] 用户账号系统
- [ ] 实时对局同步
- [ ] PWA离线支持

## 🤝 贡献

欢迎提交Issue和Pull Request！

## 📄 许可证

MIT License

## 📚 相关文档

- **后端文档**: [backend/README.md](backend/README.md)
- **前端文档**: [frontend/README.md](frontend/README.md)

---

**德州扑克积分统计系统 v0.1.1**  
*让每一局游戏都有数据可循* 🃏
